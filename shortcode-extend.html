<!doctype html>
<html>
   <head>
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="chrome=1">
      <title>Extend Shortcodes - Opencart Shortcodes</title>
      <link rel="icon" type="image/x-icon" href="favicon.ico">

      <link rel="stylesheet" href="stylesheets/styles.css">
      <link rel="stylesheet" href="stylesheets/pygment_trac.css">
      <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
      <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
      <![endif]-->
   </head>
   <body>
      <div class="wrapper">
         <header>
            <h1>Opencart Shortcodes</h1>
            <p>Shortcodes for OpenCart.</p>

            <ul class="menu">
               <li><a href="index.html">Home</a></li>
               <li><a href="install.html">Installation</a></li>
               <li><a href="shortcode-101.html">Shortcode 101</a></li>
               <li><a href="shortcode-default.html">Default Shortcodes</a></li>
               <li><a href="shortcode-extend.html">Extend Shortcodes</a></li>
               <li><a href="changelog.html">Changelog</a></li>
               <li><a href="license.html">License</a></li>
            </ul>
            
            <div class="download-project" data-html="inc_download"></div>
         
            <div class="footer"><small>Theme based on <a href="https://github.com/orderedlist/minimal">minimal</a></small></div>
         </header>
         
         <section>
            <h1>Extend Shortcodes</h1>

            <h3><a name="scripting" class="anchor" href="#scripting"><span class="octicon octicon-link"></span></a>Scripting</h3>
            
            <p>Shortcodes class is designed to extend controller, means you can use most of OpenCart API within shortcode function. Including but not limited to load model, load language, get route, get user info, get store id, even load MVC child.</p>
            <p>Default shorcodes (<code>system/helper/shortcodes_default.php</code>) is purposely to give you example what you can do with shortcodes. But now let's understand how <strong>tag-attributes-content</strong> used to develope shortcodes.</p>
            
            <h4><a name="tag" class="anchor" href="#tag"><span class="octicon octicon-link"></span></a>Tag</h4>
            <p>Tag (or shortcode) name is referring to function name, should be all lowercase, letters or numbers and underscores.</p>
<pre>
function <span class="text-red">link_product</span>($atts, $content = '') {
   ... ...
}
</pre>
            <h4><a name="attributes" class="anchor" href="#attributes"><span class="octicon octicon-link"></span></a>Attributes</h4>
            <p>Attributes describe option of shortcode. By combining attributes, the shortcode can be simple or very complex. Inside shortcode, it is mandatory to set default value to register the attirubbutes and as fallback value.</p>
            <p>There is two method to parse the attributes as code below.</p>
<pre>
function link_product(<span class="text-red">$atts</span>, $content = '') {
   <span class="text-green">// method one</span>
   <span class="text-red">extract($this->shortcodes->shortcode_atts(array(
      'id'     => 0,
      'path'   => 0,
      'brand'  => 0
   ), $atts));</span>
   
   if (<span class="text-red">$id</span>) {
      ... ...
   }
   
   <span class="text-green">// method two</span>
   <span class="text-red">$data = $this->shortcodes->shortcode_atts(array(
      'id'     => 0,
      'path'   => 0,
      'brand'  => 0
   ), $atts);</span>
   
   if (<span class="text-red">$data['id']</span>) {
      ... ...
   }
}
</pre>
<p>The suggestion to use is the first method.</p>

            <h4><a name="content" class="anchor" href="#content"><span class="octicon octicon-link"></span></a>Content</h4>
            
            <p>Content included in the return value without any escaping or encoding, the user can include raw HTML:</p>
            
            <pre>[caption]&lt;a href="http://example.com/">My Caption</a>[/caption]</pre>
            
            <p>Which would produce:</p>
            
            <pre>&lt;span class="caption">&lt;a href="http://example.com/">My Caption&lt;/a>&lt;/span></pre>
            
            <p>The shortcode parser uses a single pass on the post content. This means that if the $content of a shortcode contains another shortcode, it won't be parsed.</p>
            <p>If the enclosing shortcodes designed to allow another shortcode to be parsed, the handler function need to use <code>$this->shortcodes->do_shortcode()</code></p>
<pre>
function shortcodes ($atts, content = '') {
   return '&ltspan class="shortcodes">' . <span class="text-red">$this->shortcodes->do_shortcode(<span class="text-green">$content</span>)</span> . '&lt/span>';
}
</pre>

            <h3>Development</h3>
            <ol>
               <li>Shortcodes file structure:
                  <ol class="l-a">
                     <li>Default shortcode file is <code>system/helper/shortcodes_default.php</code></li>
                     <li>Shortcodes for an extensions at <code>catalog/view/shortcodes/*.php</code></li>
                     <li>Shortcode file for a theme is <code>catalog/view/theme/default/shortcodes_theme.php</code></li>
                     <li>Custom shortcodes purposely for user to customize default, extensions or theme shortcodes without worrying update break. The shortcode file is <code>catalog/view/theme/default/shortcodes_custom.php</code></li>
                  </ol>
               </li>
               <li>Class name of the shortcode is contain the "Shortcodes" following by the filename in titlecase. As an example, if your shortcode extensions file is <code>my_extensions.php</code> then the class would be:
<pre>
class <span class="text-red">ShortcodesMyExtensions</span> extends Controller {
   ... ...
}
</pre>
               </li>
               <li>Shortcodes class is extending controller, it's mean you can use most OpenCart API.
<pre>
class ShortcodesExtend <span class="text-red">extends Controller</span> {
   function my_shortcode($atts, $content = '') {
      <span class="text-green">$this->load->model('catalog/product');
      $this->load->language('product/product');
      $this->url->link('product/product', 'product_id=' . $id, $ssl)
      $this->getChild('module/slideshow', array( ... ... ));
      ... ...</span>
   }
}
</pre>
               </li>
               <li>Shortcode tag is come from the function name. All lowercase, letters, numbers and underscores.</p>
<pre>
class ShortcodesExtend extends Controller {
   function <span class="text-red">link_product</span>($atts, $content = '') { ... ... }
   function <span class="text-red">link_custom</span>($atts, $content = '') { ... ... }
   function <span class="text-red">module_product</span>($atts) { ... ... }
}
</pre>
               </li>
               <li>Same shortcode tag will overwrite previous shortcode.</p>
<pre>
<span class="text-blue"># system/helper/shortcodes_default.php</span>
class ShortcodesDefault extends Controller {
   function <span class="text-red">foobar</span>() { return 'default'; }
}

<span class="text-blue"># catalog/view/shortcodes/my_extensions.php</span>
class ShortcodesMyExtensions extends Controller {
   function <span class="text-red">foobar</span>() { return 'extensions'; }
}

<span class="text-blue"># catalog/view/theme/default/shortcodes_theme.php</span>
class ShortcodesTheme extends Controller {
   function <span class="text-red">foobar</span>() { return 'theme'; }
}

<span class="text-green">// Output of [foobar /]</span>
theme
</pre>
               </li>
               <li>Shortcodes inside $content is not automatically parsed, manual act is required.</p>
<pre>
function shortcodes ($atts, <span class="text-green">content</span> = '') {
   return '&lt;span class="shortcodes">' . <span class="text-red">$this->shortcodes->do_shortcode(<span class="text-green">$content</span>)</span> . '&lt;/span>';
}
</pre>
               </li>
            </ol>

         </section>
      </div>
      
      <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
      <script>window.jQuery || document.write('<script src="javascripts/jquery-2.0.3.min.js"><\/script>')</script>
      <script src="javascripts/microTplEngine.js"></script>
      <script src="javascripts/scale.fix.js"></script>
      <script type="text/javascript">
         var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
         document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
      </script>
      <script type="text/javascript">
         try {
            var pageTracker = _gat._getTracker("UA-44563939-1");
         pageTracker._trackPageview();
         } catch(err) {}
      </script>
   </body>
</html>